<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Vast 2017 MINICHALLENGE 1</title>

	<link rel="stylesheet" href="dc.css">


</head>
<body>
	<h1>ChartTesting</h1>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

    <div>
         <div style = "width: 600px;">
            <div id = "mystats" class = "dc-data-count" style = "float: right">
               <span class = "filter-count"></span> selected out of <span
                  class = "total-count"></span> | <a href = "javascript:dc.filterAll();
                  dc.renderAll();">Reset All</a>
            </div>
         </div>

         <div style = "clear: both; padding-top: 20px;">
            <div>
               <div id="line"></div>
               <div id="pie"></div>
            </div>
         </div>

         <div style = "clear: both">
            <div class = "dc-data-grid" id = "mygrid"></div>
         </div>
      </div>

	<script>
       var barChart = dc.barChart('#line'); // , 'myChartGroup');
         var pieChart = dc.pieChart('#pie'); //, 'myChartGroup');
         var countChart = dc.dataCount("#mystats");
         var gridChart = dc.dataGrid("#mygrid");

		d3.csv("./Data/DataSlice.csv", function(errors, people) {
            var mycrossfilter = crossfilter(people);

            // age dimension
            var ageDimension = mycrossfilter.dimension(function(data) { 
               return ~~((Date.now() - new Date(data.DOB)) / (31557600000)) 
            });
            var ageGroup = ageDimension.group().reduceCount();

            //occupation dimension
            var occupancyDimension = mycrossfilter.dimension(function(data){
               return data.JobTitle;
            });
            var top10 = occupancyDimension.top(10);
            var occupationGroup = occupancyDimension.group().reduceCount();


            // gender dimension
            var genderDimension = mycrossfilter.dimension(function(data) { 
               return data.gender; 
            });
            var genderGroup = genderDimension.group().reduceCount();

            // year dimension
            var yearDimension = mycrossfilter.dimension(function(data){
               return data.Year;
            });
            var yearGroup = yearDimension.group().reduceCount();

            // total pay dimension
            var totalpayDimension = mycrossfilter.dimension(function(data){
               return data.TotalPay;
            });
            var totalpayGroup = totalpayDimension.group().reduceCount();

         barChart
            .width(400)
            .height(200)
            .x(d3.scale.ordinal())
            .yAxisLabel("Count")
            .xAxisLabel("Age")
            .elasticY(true)
            .elasticX(true)
            .dimension(occupancyDimension)
            .group(occupationGroup);

         barChart
            .height(190)
            .width(8000)
            .x(d3.scale.ordinal())
            .xUnits(dc.units.ordinal)
            .brushOn(false)
            .transitionDuration(1500)
            .dimension(occupancyDimension)
            .group(occupationGroup);
         pieChart
            .width(200)
            .height(100)
            .dimension(genderDimension)
            .group(genderGroup);

         countChart
            .dimension(mycrossfilter)
            .group(mycrossfilter.groupAll());

         gridChart
            .dimension(genderDimension)
            .group(function (data) {
               return data.gender;
            })
            .size(100)
            .htmlGroup (function(d) { 
               return 'Gender: ' + d.key +
               '; Count: ' + d.values.length +
               ' people'
            })
            .html (function(d) { return d.EmployeeName; })
            .sortBy(function (d) {
               return d.EmployeeName;
            })
            .order(d3.ascending);

         barChart.render();
         pieChart.render();
         countChart.render();
         gridChart.render();
      });
	</script>
</body>
</html>